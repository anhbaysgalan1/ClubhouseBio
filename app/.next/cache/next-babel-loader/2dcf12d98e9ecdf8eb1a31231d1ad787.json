{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jan/Documents/Programming/leetcodebuddy/frontend/app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jan/Documents/Programming/leetcodebuddy/frontend/app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/jan/Documents/Programming/leetcodebuddy/frontend/app/components/auth/AuthProvider.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport Cookies from 'js-cookie';\nimport AuthContext from './AuthContext'; // import Router, { useRouter } from 'next/router'\n// api here is an axios instance which has the baseURL set according to the env.\n\nimport api from '../../services/api';\nexport default _s(function (_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  useEffect(function () {\n    function loadUserFromCookies() {\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    function _loadUserFromCookies() {\n      _loadUserFromCookies = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var token, _yield$api$get, _user;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                token = Cookies.get('token');\n\n                if (!token) {\n                  _context.next = 9;\n                  break;\n                }\n\n                console.log(\"Got a token in the cookies, let's see if it is valid\");\n                api.defaults.headers.Authorization = \"Bearer \".concat(token);\n                _context.next = 6;\n                return api.get('users/me');\n\n              case 6:\n                _yield$api$get = _context.sent;\n                _user = _yield$api$get.data;\n                if (_user) setUser(_user);\n\n              case 9:\n                setLoading(false);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    loadUserFromCookies();\n  }, []);\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n      var _yield$api$post, token, _yield$api$get2, _user2;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return api.post('auth/token', {\n                email: email,\n                password: password\n              });\n\n            case 2:\n              _yield$api$post = _context2.sent;\n              token = _yield$api$post.data;\n\n              if (!token) {\n                _context2.next = 14;\n                break;\n              }\n\n              console.log(\"Got token\");\n              Cookies.set('token', token, {\n                expires: 60\n              });\n              api.defaults.headers.Authorization = \"Bearer \".concat(token.token);\n              _context2.next = 10;\n              return api.get('users/me');\n\n            case 10:\n              _yield$api$get2 = _context2.sent;\n              _user2 = _yield$api$get2.data;\n              setUser(_user2);\n              console.log(\"Got user\", _user2);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var logout = function logout(email, password) {\n    Cookies.remove('token');\n    setUser(null);\n    delete api.defaults.headers.Authorization;\n    window.location.pathname = '/login';\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      isAuthenticated: !!user,\n      isLoading: !!loading,\n      user: user,\n      login: login,\n      logout: logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 9\n  }, _this);\n}, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");","map":{"version":3,"sources":["/Users/jan/Documents/Programming/leetcodebuddy/frontend/app/components/auth/AuthProvider.tsx"],"names":["React","useState","useEffect","Cookies","AuthContext","api","children","user","setUser","loading","setLoading","loadUserFromCookies","token","get","console","log","defaults","headers","Authorization","data","login","email","password","post","set","expires","logout","remove","window","location","pathname","isAuthenticated","isLoading"],"mappings":"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","sourcesContent":["\nimport React, { useState, useEffect } from 'react'\nimport Cookies from 'js-cookie'\nimport AuthContext from './AuthContext'\n// import Router, { useRouter } from 'next/router'\n\n// api here is an axios instance which has the baseURL set according to the env.\nimport api from '../../services/api';\n\nexport default ({children }) => {\n\n    const [user, setUser] = useState(null)\n    const [loading, setLoading] = useState(true)\n\n    useEffect(() => {\n        async function loadUserFromCookies() {\n            const token = Cookies.get('token')\n            if (token) {\n                console.log(\"Got a token in the cookies, let's see if it is valid\")\n                api.defaults.headers.Authorization = `Bearer ${token}`\n                const { data: user } = await api.get('users/me')\n                if (user) setUser(user);\n            }\n            setLoading(false)\n        }\n        loadUserFromCookies()\n    }, [])\n\n    const login = async (email, password) => {\n        const { data: token } = await api.post('auth/token', { email, password })\n        if (token) {\n            console.log(\"Got token\")\n            Cookies.set('token', token, { expires: 60 })\n            api.defaults.headers.Authorization = `Bearer ${token.token}`\n            const { data: user } = await api.get('users/me')\n            setUser(user)\n            console.log(\"Got user\", user)\n        }\n    }\n\n    const logout = (email, password) => {\n        Cookies.remove('token')\n        setUser(null)\n        delete api.defaults.headers.Authorization\n        window.location.pathname = '/login'\n    }\n\n\n    return (\n        <AuthContext.Provider value={{ isAuthenticated: !!user, isLoading: !!loading, user, login, logout }}>\n            {children}\n        </AuthContext.Provider>\n    )\n}"]},"metadata":{},"sourceType":"module"}